# API Ranking Documentation\n\n## Tổng quan\nTôi đã tạo hoàn chỉnh API ranking cho trang bảng xếp hạng người báo cáo với các chức năng sau:\n\n## 🚀 API Endpoints đã tạo\n\n### 1. GET `/api/v1/report/ranking`\n**Mục đích**: Lấy bảng xếp hạng với phân trang\n\n**Parameters**:\n- `page` (optional): Số trang (bắt đầu từ 0, mặc định 0)\n- `size` (optional): Số items mỗi trang (mặc định 10)\n\n**Response**:\n```json\n{\n  \"reporters\": [\n    {\n      \"rank\": 1,\n      \"email\": \"user@example.com\",\n      \"approvedReports\": 25,\n      \"totalReports\": 30,\n      \"successRate\": 83.33,\n      \"firstReportDate\": \"2024-01-15T10:30:00\",\n      \"lastReportDate\": \"2024-06-18T14:20:00\"\n    }\n  ],\n  \"currentPage\": 0,\n  \"totalPages\": 10,\n  \"totalElements\": 100,\n  \"pageSize\": 10\n}\n```\n\n### 2. GET `/api/v1/report/ranking/top3`\n**Mục đích**: Lấy top 3 để hiển thị podium\n\n**Response**:\n```json\n[\n  {\n    \"rank\": 1,\n    \"email\": \"top1@example.com\",\n    \"approvedReports\": 184,\n    \"totalReports\": 200,\n    \"successRate\": 92.0,\n    \"firstReportDate\": \"2023-12-01T08:00:00\",\n    \"lastReportDate\": \"2024-06-18T16:45:00\"\n  },\n  // ... top 2 và 3\n]\n```\n\n### 3. GET `/api/v1/report/ranking/stats`\n**Mục đích**: Lấy thống kê tổng quan\n\n**Response**:\n```json\n{\n  \"totalReporters\": 1250,\n  \"totalApprovedReports\": 8460,\n  \"averageSuccessRate\": 78.5\n}\n```\n\n## 🏗️ Cấu trúc Database\n\n### Report Entity\n- `emailAuthorReport`: Email người báo cáo\n- `status`: Trạng thái (1=PENDING, 2=APPROVED, 3=REJECTED)\n- `dateReport`: Ngày báo cáo\n\n### StatusReportEnum\n- `PENDING(1)`: Chờ xử lý\n- `APPROVED(2)`: Đã được duyệt ✅\n- `REJECTED(3)`: Đã bị từ chối\n\n## 📊 Logic Ranking\n\n### Điều kiện xếp hạng:\n1. **Chỉ tính báo cáo được duyệt** (`status = 2`)\n2. **Sắp xếp theo số báo cáo được duyệt** (giảm dần)\n3. **Tính tỷ lệ thành công** = (Số báo cáo được duyệt / Tổng số báo cáo) × 100\n\n### SQL Query chính:\n```sql\nSELECT \n    ROW_NUMBER() OVER (ORDER BY COUNT(CASE WHEN status = 2 THEN 1 END) DESC) as rank,\n    emailAuthorReport,\n    COUNT(CASE WHEN status = 2 THEN 1 END) as approvedReports,\n    COUNT(*) as totalReports,\n    ROUND((COUNT(CASE WHEN status = 2 THEN 1 END) * 100.0 / COUNT(*)), 2) as successRate,\n    MIN(dateReport) as firstReportDate,\n    MAX(dateReport) as lastReportDate\nFROM Report \nWHERE emailAuthorReport IS NOT NULL\nGROUP BY emailAuthorReport\nHAVING COUNT(*) > 0\nORDER BY COUNT(CASE WHEN status = 2 THEN 1 END) DESC\n```\n\n## 🎨 Frontend Integration\n\n### RankingService đã tạo\n- `getReporterRanking(page, size)`: Lấy ranking với phân trang\n- `getTop3Reporters()`: Lấy top 3\n- `getRankingStats()`: Lấy thống kê\n\n### Component Features\n- ✅ **Loading states** với spinner\n- ✅ **Error handling** với retry button\n- ✅ **Responsive design** \n- ✅ **Email masking** để bảo vệ privacy\n- ✅ **Real-time stats** \n- ✅ **Beautiful animations**\n\n## 🔧 Cách sử dụng\n\n### 1. Start Backend\n```bash\ncd CheckScam-backend\n./mvnw spring-boot:run\n```\n\n### 2. Update API URL\nTrong `ranking.service.ts`, đảm bảo `apiUrl` đúng:\n```typescript\nprivate apiUrl = 'http://localhost:8080/api/v1/report';\n```\n\n### 3. Test API\n```bash\n# Test ranking endpoint\ncurl \"http://localhost:8080/api/v1/report/ranking?page=0&size=10\"\n\n# Test top 3\ncurl \"http://localhost:8080/api/v1/report/ranking/top3\"\n\n# Test stats\ncurl \"http://localhost:8080/api/v1/report/ranking/stats\"\n```\n\n## 📝 Lưu ý quan trọng\n\n### Database Requirements\n1. Cần có dữ liệu trong bảng `Report`\n2. Trường `emailAuthorReport` không được null\n3. Trường `status` phải có giá trị hợp lệ (1,2,3)\n\n### Performance\n- Đã thêm **index** cho `date_report DESC`\n- Query được tối ưu với `ROW_NUMBER()` window function\n- Pagination để tránh load quá nhiều dữ liệu\n\n### Privacy\n- Email được **mask** ở frontend: `us***r@gmail.com`\n- Không lưu trữ thông tin cá nhân nhạy cảm\n\n## 🎯 Kết quả\n\nBạn sẽ có:\n1. **API hoàn chỉnh** với 3 endpoints\n2. **Frontend component** với design đẹp\n3. **Real-time data** từ database\n4. **Phân trang 10 items** như yêu cầu\n5. **Top 3 podium** với rewards\n6. **Statistics cards** động\n7. **Error handling** professional\n\n🚀 **API đã sẵn sàng sử dụng!**\n