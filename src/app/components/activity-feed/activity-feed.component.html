<div class="activity-feed-container">
  <!-- Header với CheckScam branding -->
  <div class="header">
    <div class="header-content">
      <div class="title-section">
        <div class="checkscam-logo">
          <div class="status-indicator" [class.connected]="isConnected"></div>
          <div class="logo-text">
            <h1>🛡️ CheckScam</h1>
            <p>Hoạt động bảo vệ thời gian thực</p>
          </div>
        </div>
      </div>
      
      <div class="controls">
        <select [(ngModel)]="currentFilter" (change)="onFilterChange()" class="filter-select">
          <option value="all">Tất cả hoạt động</option>
          <option value="post">📝 Đăng tin tức</option>
          <option value="report">📤 Gửi báo cáo</option>
          <option value="join">👥 Tham gia</option>
        </select>
        
        <button class="btn btn-primary" (click)="openCreateModal()">
          ➕ Tạo hoạt động
        </button>
        
        <button class="btn btn-warning" (click)="openDangerousModal()">
          ⚠️ Hoạt động nguy hiểm
        </button>
        
        <button class="btn btn-danger" (click)="clearFeed()">
          🗑️ Xóa feed
        </button>
      </div>
    </div>
    
    <!-- Statistics bar cho CheckScam -->
    <div class="stats-bar">
      <div class="stat-item post">
        <span class="stat-icon">📝</span>
        <div class="stat-content">
          <span class="stat-label">Tin tức:</span>
          <span class="stat-value">{{ stats.totalPosts }}</span>
        </div>
      </div>
      <div class="stat-item report">
        <span class="stat-icon">📤</span>
        <div class="stat-content">
          <span class="stat-label">Báo cáo:</span>
          <span class="stat-value">{{ stats.totalReports }}</span>
        </div>
      </div>
      <div class="stat-item join">
        <span class="stat-icon">👥</span>
        <div class="stat-content">
          <span class="stat-label">Tham gia:</span>
          <span class="stat-value">{{ stats.totalJoins }}</span>
        </div>
      </div>
      <div class="stat-item online">
        <span class="stat-icon">👥</span>
        <div class="stat-content">
          <span class="stat-label">Online:</span>
          <span class="stat-value">{{ stats.connectedClients }}</span>
        </div>
      </div>
      <div class="stat-item connection">
        <span class="stat-icon">🔗</span>
        <div class="stat-content">
          <span class="stat-label">Kết nối:</span>
          <span class="stat-value">{{ isConnected ? 'Đã kết nối' : 'Mất kết nối' }}</span>
        </div>
      </div>
    </div>
  </div>

  <!-- Activity Feed -->
  <div class="activity-feed">
    <div *ngIf="isLoading" class="loading">
      <div class="spinner"></div>
      <span>Đang tải hoạt động CheckScam...</span>
    </div>

    <div *ngIf="!isLoading && activities.length === 0" class="no-activities">
      <span>Chưa có hoạt động nào</span>
    </div>

    <div *ngFor="let activity of activities" 
         [class]="getActivityItemClass(activity)"
         (click)="onActivityClick(activity)"
         [style.cursor]="canNavigate(activity) ? 'pointer' : 'default'">
      <img [src]="activity.user.avatar" [alt]="activity.user.name" class="avatar">
      <div class="content">
        <div class="user-name">{{ activity.user.name }}</div>
        <div class="action">
          <span class="activity-icon">{{ getActionIcon(activity.actionType) }}</span>
          {{ getActionText(activity.actionType) }} 
          <span class="target">"{{ activity.targetName }}"</span>
          <span *ngIf="canNavigate(activity)" class="clickable-hint"> → Xem chi tiết</span>
        </div>
        
        <div *ngIf="activity.metadata" class="metadata">
          <span *ngFor="let tag of renderMetadata(activity.metadata)" 
                class="metadata-tag" 
                [ngClass]="tag.class">
            {{ tag.text }}
          </span>
        </div>
        
        <div class="time">
          🕒 {{ getTimeAgo(activity.createdAt) }}
          <a *ngIf="activity.targetUrl" 
             [href]="activity.targetUrl" 
             target="_blank" 
             rel="noopener"
             (click)="$event.stopPropagation()">
            🔗 Xem chi tiết
          </a>
        </div>
      </div>
    </div>
  </div>
</div>

<!-- Modal tạo activity -->
<div *ngIf="showCreateModal" class="modal" (click)="closeCreateModal()">
  <div class="modal-content" (click)="$event.stopPropagation()">
    <div class="modal-header">
      <h3>Tạo hoạt động CheckScam</h3>
      <span class="close" (click)="closeCreateModal()">&times;</span>
    </div>
    
    <form (ngSubmit)="createActivity()" #createFormRef="ngForm">
      <div class="form-group">
        <label for="userId">Người dùng:</label>
        <select [(ngModel)]="createForm.user_id" name="user_id" required>
          <option value="1">Nguyễn Thành Hưng</option>
          <option value="2">Xuân Dong Ho</option>
          <option value="3">Lê Văn Khải</option>
          <option value="4">CheckScam Admin</option>
          <option value="5">Minh Tuấn</option>
        </select>
      </div>
      
      <div class="form-group">
        <label for="actionType">Loại hoạt động:</label>
        <select [(ngModel)]="createForm.action_type" name="action_type" required>
          <option value="post">📝 Đăng tin tức</option>
          <option value="report">📤 Gửi báo cáo</option>
          <option value="join">👥 Tham gia</option>
        </select>
      </div>
      
      <div class="form-group">
        <label for="targetType">Loại đối tượng:</label>
        <select [(ngModel)]="createForm.target_type" name="target_type">
          <option value="news">📰 Tin tức</option>
          <option value="report">📋 Báo cáo</option>
          <option value="community">👥 Cộng đồng</option>
        </select>
      </div>
      
      <div class="form-group">
        <label for="targetName">Mô tả hoạt động:</label>
        <input type="text" 
               [(ngModel)]="createForm.target_name"
               name="target_name"
               placeholder="VD: Cảnh báo: Website lừa đảo mới xuất hiện" 
               required>
      </div>
      
      <div class="form-group">
        <label for="targetUrl">URL (tùy chọn):</label>
        <input type="url" 
               [(ngModel)]="createForm.target_url"
               name="target_url"
               placeholder="https://suspicious-website.com">
      </div>
      
      <div class="form-group">
        <label for="metadata">Metadata (JSON):</label>
        <textarea [(ngModel)]="createForm.metadata"
                  name="metadata"
                  rows="3"
                  placeholder='{"category": "warning", "priority": "high"}'></textarea>
      </div>
      
      <div class="form-actions">
        <button type="button" class="btn btn-secondary" (click)="closeCreateModal()">Hủy</button>
        <button type="submit" class="btn btn-primary">Tạo hoạt động</button>
      </div>
    </form>
  </div>
</div>

<!-- Modal hoạt động nguy hiểm -->
<div *ngIf="showDangerousModal" class="modal" (click)="closeDangerousModal()">
  <div class="modal-content" (click)="$event.stopPropagation()">
    <div class="modal-header">
      <h3>⚠️ Hoạt động nguy hiểm gần đây</h3>
      <span class="close" (click)="closeDangerousModal()">&times;</span>
    </div>
    
    <div class="dangerous-list">
      <div *ngIf="dangerousActivities.length === 0" class="loading">
        <span>Không có hoạt động nguy hiểm nào</span>
      </div>
      
      <div *ngFor="let activity of dangerousActivities" class="dangerous-item">
        <h4>{{ getActionIcon(activity.actionType) }} {{ activity.targetName }}</h4>
        <p><strong>Người dùng:</strong> {{ activity.user.name }}</p>
        <p><strong>Thời gian:</strong> {{ getTimeAgo(activity.createdAt) }}</p>
        <p *ngIf="activity.metadata?.risk_level">
          <strong>Mức độ rủi ro:</strong> {{ translateRiskLevel(activity.metadata.risk_level) }}
        </p>
        <p *ngIf="activity.metadata?.result">
          <strong>Kết quả:</strong> {{ translateResult(activity.metadata.result) }}
        </p>
        <p *ngIf="activity.metadata?.confidence">
          <strong>Độ tin cậy:</strong> {{ activity.metadata.confidence }}%
        </p>
      </div>
    </div>
  </div>
</div>