<div class="main-content-container">
  <div class="modern-card">
    <div class="modern-card-header">
      <h6 class="card-title">Th√™m tin t·ª©c m·ªõi</h6>
    </div>
    <div class="modern-card-body">
      <div class="news-form">
        <div class="form-group">
          <label class="form-label" for="newsName">T√™n tin t·ª©c</label>
          <input type="text"
                 id="newsName"
                 class="form-control"
                 placeholder="Nh·∫≠p t√™n tin t·ª©c"
                 [(ngModel)]="name" />
        </div>

        <div class="form-group">
          <label class="form-label" for="shortDescription">M√¥ t·∫£ ng·∫Øn</label>
          <textarea id="shortDescription"
                    class="form-control"
                    placeholder="Nh·∫≠p m√¥ t·∫£ ng·∫Øn"
                    [(ngModel)]="shortDescription"
                    rows="3"></textarea>
        </div>

        <div class="form-group">
          <label class="form-label" for="content">N·ªôi dung chi ti·∫øt</label>
          
          <!-- Enhanced Rich Text Editor -->
          <div class="rich-text-editor">
            <!-- Enhanced Toolbar -->
            <div class="editor-toolbar">
              <!-- Text Formatting -->
              <div class="toolbar-group">
                <button type="button" (mousedown)="execCommand('bold', $event)" class="toolbar-btn" title="ƒê·∫≠m">
                  <i class="fas fa-bold"></i>
                </button>
                <button type="button" (mousedown)="execCommand('italic', $event)" class="toolbar-btn" title="Nghi√™ng">
                  <i class="fas fa-italic"></i>
                </button>
                <button type="button" (mousedown)="execCommand('underline', $event)" class="toolbar-btn" title="G·∫°ch ch√¢n">
                  <i class="fas fa-underline"></i>
                </button>
                <button type="button" (mousedown)="execCommand('strikeThrough', $event)" class="toolbar-btn" title="G·∫°ch ngang">
                  <i class="fas fa-strikethrough"></i>
                </button>
              </div>

              <div class="toolbar-divider"></div>

              <!-- Font Size -->
              <div class="toolbar-group">
                <select class="toolbar-select" (change)="changeFontSize($event)" title="C·ª° ch·ªØ">
                  <option value="">C·ª° ch·ªØ</option>
                  <option value="1">R·∫•t nh·ªè</option>
                  <option value="2">Nh·ªè</option>
                  <option value="3">B√¨nh th∆∞·ªùng</option>
                  <option value="4">L·ªõn</option>
                  <option value="5">R·∫•t l·ªõn</option>
                  <option value="6">Kh·ªïng l·ªì</option>
                  <option value="7">C·ª±c l·ªõn</option>
                </select>
              </div>

              <div class="toolbar-divider"></div>

              <!-- Text Color -->
              <div class="toolbar-group">
                <input type="color" class="color-picker" (change)="changeTextColor($event)" title="M√†u ch·ªØ">
                <input type="color" class="color-picker" (change)="changeBackgroundColor($event)" title="M√†u n·ªÅn">
              </div>

              <div class="toolbar-divider"></div>

              <!-- Headings -->
              <div class="toolbar-group">
                <select class="toolbar-select" (change)="changeHeading($event)" title="Ti√™u ƒë·ªÅ">
                  <option value="">ƒê·ªãnh d·∫°ng</option>
                  <option value="h1">Ti√™u ƒë·ªÅ 1</option>
                  <option value="h2">Ti√™u ƒë·ªÅ 2</option>
                  <option value="h3">Ti√™u ƒë·ªÅ 3</option>
                  <option value="h4">Ti√™u ƒë·ªÅ 4</option>
                  <option value="h5">Ti√™u ƒë·ªÅ 5</option>
                  <option value="h6">Ti√™u ƒë·ªÅ 6</option>
                  <option value="p">ƒêo·∫°n vƒÉn</option>
                </select>
              </div>

              <div class="toolbar-divider"></div>

              <!-- Alignment -->
              <div class="toolbar-group">
                <button type="button" (mousedown)="execCommand('justifyLeft', $event)" class="toolbar-btn" title="CƒÉn tr√°i">
                  <i class="fas fa-align-left"></i>
                </button>
                <button type="button" (mousedown)="execCommand('justifyCenter', $event)" class="toolbar-btn" title="CƒÉn gi·ªØa">
                  <i class="fas fa-align-center"></i>
                </button>
                <button type="button" (mousedown)="execCommand('justifyRight', $event)" class="toolbar-btn" title="CƒÉn ph·∫£i">
                  <i class="fas fa-align-right"></i>
                </button>
                <button type="button" (mousedown)="execCommand('justifyFull', $event)" class="toolbar-btn" title="CƒÉn ƒë·ªÅu">
                  <i class="fas fa-align-justify"></i>
                </button>
              </div>

              <div class="toolbar-divider"></div>

              <!-- Lists -->
              <div class="toolbar-group">
                <button type="button" (mousedown)="execCommand('insertUnorderedList', $event)" class="toolbar-btn" title="Danh s√°ch c√≥ d·∫•u ƒë·∫ßu d√≤ng">
                  <i class="fas fa-list-ul"></i>
                </button>
                <button type="button" (mousedown)="execCommand('insertOrderedList', $event)" class="toolbar-btn" title="Danh s√°ch c√≥ s·ªë">
                  <i class="fas fa-list-ol"></i>
                </button>
                <button type="button" (mousedown)="execCommand('outdent', $event)" class="toolbar-btn" title="Gi·∫£m th·ª•t l·ªÅ">
                  <i class="fas fa-outdent"></i>
                </button>
                <button type="button" (mousedown)="execCommand('indent', $event)" class="toolbar-btn" title="TƒÉng th·ª•t l·ªÅ">
                  <i class="fas fa-indent"></i>
                </button>
              </div>

              <div class="toolbar-divider"></div>

              <!-- Insert Options -->
              <div class="toolbar-group">
                <button type="button" (click)="insertLink($event)" class="toolbar-btn" title="Ch√®n li√™n k·∫øt">
                  <i class="fas fa-link"></i>
                </button>
                <button type="button" (click)="insertTable($event)" class="toolbar-btn" title="Ch√®n b·∫£ng">
                  <i class="fas fa-table"></i>
                </button>
                <button type="button" (click)="insertHorizontalRule($event)" class="toolbar-btn" title="Ch√®n ƒë∆∞·ªùng k·∫ª ngang">
                  <i class="fas fa-minus"></i>
                </button>
              </div>

              <div class="toolbar-divider"></div>

              <!-- Image Insert -->
              <div class="toolbar-group">
                <button type="button" (click)="triggerImageUpload()" class="toolbar-btn toolbar-btn-primary" title="Ch√®n ·∫£nh">
                  <i class="fas fa-image"></i>
                  <span>Ch√®n ·∫£nh</span>
                </button>
                <input #imageInput type="file" accept="image/*" multiple style="display: none" (change)="insertImages($event)">
              </div>

              <div class="toolbar-divider"></div>

              <!-- Actions -->
              <div class="toolbar-group">
                <button type="button" (mousedown)="execCommand('undo', $event)" class="toolbar-btn" title="Ho√†n t√°c">
                  <i class="fas fa-undo"></i>
                </button>
                <button type="button" (mousedown)="execCommand('redo', $event)" class="toolbar-btn" title="L√†m l·∫°i">
                  <i class="fas fa-redo"></i>
                </button>
                <button type="button" (click)="clearFormatting($event)" class="toolbar-btn" title="X√≥a ƒë·ªãnh d·∫°ng">
                  <i class="fas fa-remove-format"></i>
                </button>
              </div>

              <div class="toolbar-divider"></div>

              <!-- Document Style Controls -->
              <div class="toolbar-group document-style-group">
                <!-- Style Toggle -->
                <button type="button" 
                        (click)="toggleWordStyle()" 
                        class="toolbar-btn"
                        [class.active]="wordStyleEnabled"
                        title="B·∫≠t/t·∫Øt ƒë·ªãnh d·∫°ng Word">
                  <i class="fas fa-file-word"></i>
                  <span>Word Style</span>
                </button>
                
                <!-- Document Style Selector -->
                <select class="toolbar-select" 
                        (change)="changeDocumentStyle($any($event.target).value)"
                        [value]="documentStyle"
                        [disabled]="!wordStyleEnabled"
                        title="Ch·ªçn ki·ªÉu t√†i li·ªáu">
                  <option value="word">Word Document</option>
                  <option value="academic">Academic Paper</option>
                  <option value="web">Web Article</option>
                </select>
                
                <!-- Auto Numbering Toggle -->
                <button type="button" 
                        (click)="toggleAutoNumbering()" 
                        class="toolbar-btn"
                        [class.active]="autoNumberingEnabled"
                        [disabled]="!wordStyleEnabled"
                        title="B·∫≠t/t·∫Øt ƒë√°nh s·ªë t·ª± ƒë·ªông">
                  <i class="fas fa-list-ol"></i>
                  <span>Auto #</span>
                </button>
              </div>

              <div class="toolbar-divider"></div>

              <!-- Numbering Controls -->
              <div class="toolbar-group numbering-group">
                <button type="button" 
                        (click)="addOutlineNumbering()" 
                        class="toolbar-btn"
                        title="Th√™m ƒë√°nh s·ªë outline">
                  <i class="fas fa-plus"></i>
                  <span>Add #</span>
                </button>
                
                <button type="button" 
                        (click)="removeNumbering()" 
                        class="toolbar-btn"
                        title="X√≥a ƒë√°nh s·ªë">
                  <i class="fas fa-minus"></i>
                  <span>Remove #</span>
                </button>
                
                <button type="button" 
                        (click)="applyWordTemplate()" 
                        class="toolbar-btn toolbar-btn-primary"
                        title="√Åp d·ª•ng template Word m·∫´u">
                  <i class="fas fa-file-import"></i>
                  <span>Template</span>
                </button>
              </div>

              <div class="toolbar-divider"></div>

              <!-- Table of Contents -->
              <div class="toolbar-group">
                <button type="button" 
                        (click)="toggleTableOfContents()" 
                        class="toolbar-btn"
                        [class.active]="showTableOfContents"
                        title="Hi·ªÉn th·ªã/·∫®n m·ª•c l·ª•c">
                  <i class="fas fa-list"></i>
                  <span>M·ª•c l·ª•c</span>
                </button>
                
                <!-- Debug button - x√≥a sau khi test xong -->
                <button type="button" 
                        (click)="debugTableOfContents()" 
                        class="toolbar-btn"
                        title="Debug m·ª•c l·ª•c">
                  <i class="fas fa-bug"></i>
                  <span>Debug</span>
                </button>
              </div>
            </div>
            
            <!-- Table of Contents Panel -->
            <div class="toc-panel" *ngIf="showTableOfContents && tableOfContents.length > 0">
              <div class="toc-header">
                <h6 class="toc-title">
                  <i class="fas fa-list"></i>
                  M·ª•c l·ª•c ({{tableOfContents.length}} m·ª•c)
                </h6>
                <button type="button" 
                        class="btn-close-toc" 
                        (click)="toggleTableOfContents()"
                        title="ƒê√≥ng m·ª•c l·ª•c">
                  <i class="fas fa-times"></i>
                </button>
              </div>
              
              <div class="toc-content">
                <div class="toc-list">
                  <div *ngFor="let item of tableOfContents; let i = index" 
                       class="toc-item"
                       [class]="'toc-level-' + item.level"
                       (click)="scrollToHeading(item.id)">
                    <span class="toc-number">{{i + 1}}.</span>
                    <span class="toc-text">{{item.text}}</span>
                    <span class="toc-tag">{{item.tag}}</span>
                  </div>
                </div>
              </div>
            </div>

            <!-- Document Style Info Panel -->
            <div class="document-style-info" *ngIf="wordStyleEnabled">
              <div class="style-info-content">
                <div class="current-style">
                  <strong>Style:</strong> 
                  <span [ngSwitch]="documentStyle">
                    <span *ngSwitchCase="'word'">üìÑ Microsoft Word</span>
                    <span *ngSwitchCase="'academic'">üéì Academic Paper</span>
                    <span *ngSwitchCase="'web'">üåê Web Article</span>
                  </span>
                </div>
                <div class="style-features">
                  <span class="feature" [class.active]="autoNumberingEnabled">
                    <i class="fas fa-list-ol"></i> Auto Numbering
                  </span>
                  <span class="feature active">
                    <i class="fas fa-font"></i> Font Calibri
                  </span>
                  <span class="feature active">
                    <i class="fas fa-ruler"></i> Standard Spacing
                  </span>
                </div>
              </div>
            </div>

            <!-- Content Area with drag & drop -->
            <div 
              #contentEditor
              class="editor-content"
              contenteditable="true"
              dir="ltr"
              (input)="onContentChange($event)"
              (paste)="onPaste($event)"
              (keydown)="onKeyDown($event)"
              (drop)="onDrop($event)"
              (dragover)="onDragOver($event)"
              (dragenter)="onDragEnter($event)"
              (dragleave)="onDragLeave($event)"
              data-placeholder="Nh·∫≠p n·ªôi dung chi ti·∫øt... B·∫°n c√≥ th·ªÉ k√©o th·∫£ ·∫£nh v√†o ƒë√¢y ho·∫∑c s·ª≠ d·ª•ng n√∫t 'Ch√®n ·∫£nh' ·ªü thanh c√¥ng c·ª•.">
            </div>

            <!-- Upload Progress -->
            <div *ngIf="uploadProgress > 0 && uploadProgress < 100" class="upload-progress">
              <div class="progress-bar">
                <div class="progress-fill" [style.width.%]="uploadProgress"></div>
              </div>
              <span class="progress-text">ƒêang t·∫£i l√™n... {{uploadProgress}}%</span>
            </div>
          </div>
        </div>

        <!-- Checkbox tin ch√≠nh -->
        <div class="form-group checkbox-group">
          <label for="isMain">
            <input type="checkbox" id="isMain" [(ngModel)]="isMain" />
            <span>ƒê√°nh d·∫•u l√† tin ch√≠nh</span>
          </label>
          <p class="file-hint text-warning">B·∫°n c√≥ th·ªÉ c√≥ t·ªëi ƒëa 4 tin ch√≠nh c√πng l√∫c. Tin ch√≠nh s·∫Ω ƒë∆∞·ª£c hi·ªÉn th·ªã ·ªü v·ªã tr√≠ n·ªïi b·∫≠t tr√™n trang ch·ªß.</p>
        </div>

        <div class="form-group">
          <label class="form-label" for="files">·∫¢nh ƒë√≠nh k√®m b·ªï sung (PNG, JPG, GIF)</label>
          <input id="files"
                 type="file"
                 class="form-control"
                 accept="image/*"
                 multiple
                 (change)="onFileSelect($event)" />
          <p class="file-hint">Ch·ªçn m·ªôt ho·∫∑c nhi·ªÅu ·∫£nh ƒë·ªÉ ƒë√≠nh k√®m ri√™ng bi·ªát (kh√¥ng ch√®n tr·ª±c ti·∫øp v√†o n·ªôi dung).</p>
        </div>

        <div *ngIf="selectedFiles.length" class="file-preview-area mb-3">
          <p class="file-label">C√°c t·ªáp ƒë√£ ch·ªçn:</p>
          <div class="file-grid">
            <div *ngFor="let f of selectedFiles; let i = index" class="file-item">
              <div class="file-preview" *ngIf="f.preview">
                <img [src]="f.preview" [alt]="f.name" class="preview-image">
              </div>
              <div class="file-info">
                <span class="file-name">{{ f.name }}</span>
                <span class="file-size">({{ formatFileSize(f.size) }})</span>
                <button type="button" class="btn-remove" (click)="removeFile(i)" title="X√≥a">
                  <i class="fas fa-times"></i>
                </button>
              </div>
            </div>
          </div>
        </div>

        <div class="form-actions">
          <button type="button"
                  class="btn btn-primary-gradient"
                  (click)="createNews()"
                  [disabled]="!name || !shortDescription || !content || uploadProgress > 0">
            <i class="fas fa-plus icon-margin-right"></i>
            T·∫°o tin t·ª©c
          </button>
          <button type="button"
                  class="btn btn-secondary"
                  routerLink="/admin/news">
            <i class="fas fa-arrow-left icon-margin-right"></i>
            Quay l·∫°i
          </button>
        </div>
      </div>
    </div>
  </div>
</div>
